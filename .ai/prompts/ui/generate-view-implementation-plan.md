# View Implementation Plan: Flashcard Generation

## 1. Overview
This view allows authenticated users to paste a block of text (up to 10,000 characters) to generate flashcards via AI. Users can review generated flashcards, accept or reject individual cards, and modify flashcards via an inline edit modal before submitting all accepted cards.

## 2. View Routing
- URL Path: `/generate`

## 3. Component Structure
- **GenerateView** (page-level container)
  - **TextArea**: Large textarea for pasting text.
  - **GenerateFlashcardsButton**: Triggers AI generation via the API.
  - **FlashcardList**: Displays flashcard cards generated by the AI.
    - **FlashcardListItem**: Represents each flashcard with "Front" and "Back" along with Accept, Reject, and Edit controls.
  - **EditFlashcardModal**: Modal dialog to edit flashcard details.
  - **SubmitFlashcardsButton**: Bulk save accepted flashcards.
  - **ToastNotifications**: Displays success/error messages.

## 4. Component Details

### GenerateView
- **Description:** Main container managing state for source text, generated flashcards, accepted cards, and modal visibility.
- **Main Elements:** TextArea, FlashcardList, Buttons (including GenerateFlashcardsButton, and SubmitFlashcardsButton), EditFlashcardModal.
- **Events:**: this component will react for the following events of its children:
  - On text input change, update local state.
  - On accept/reject/edit actions, update flashcards state:
    - Accept: mark flashcard as accepted.
    - Reject: mark flashcard as not accepted.
    - Edit: update flashcard in the list with new values.
  - On “Generate” click, call the generate API.
  - On “Submit flashcards” click, call the create flashcards API.
- **Validation:** Text length up to 10,000 characters.
- **Types:** `GeneratedFlashcardData` (custom type defined by the component that includes fields such as: `front` and `back` and `source` enum, `generationId`, and `isAccepted` flag). Also the component will use `CreateFlashcardsRequest` and `GenerateFlashcardsRequest`, `ResponseOfGenerateFlashcardsResponse`, and `Response` for API calls.
- **Props:** None (top-level page component).

### TextArea
- **Description:** A textarea for pasting user text.
- **Main Elements:** `<textarea>`.
- **Events:** OnChange to call the onChange handler with the new value
- **Validation:** Limit input to 10,000 characters. Validation handled by the parent component (GenerateView).
- **Types:** Simple string.
- **Props:** Value, onChange handler.

### GenerateFlashcardsButton
- **Description:** Button to trigger flashcard generation.
- **Main Elements:** A single button element.
- **Events:** OnClick calls onGenerate handler.
- **Validation:** none
- **Types:** none
- **Props:** onGenerate handler, isDisabled flag - to disable when API call is in progress or no text in the textarea.

### FlashcardList & FlashcardListItem
- **Description:** List rendering generated flashcards; each card shows flashcard details and actions.
- **Main Elements:** FlashcardListItems as Card UI structures with front and back text, action buttons (Accept, Reject, Edit). Back is hidden and revealed on click.
- **Events:**
  - Accept: called when the user clicks the Accept button
  - Reject: called when the user clicks the Reject button
  - Edit: opens EditFlashcardModal with the selected flashcard data
- **Validation:** none
- **Types:** `FlashcardListItemData` containing "front", "back", and a status flag (is accepted or not).
- **Props:** Generated flashcards, onAccept, onReject, onEdit callbacks.

### EditFlashcardModal
- **Description:** Modal to modify a chosen flashcard.
- **Main Elements:** Form with text inputs for front and back.
- **Events:** 
  - On input change.
  - On submit, validate fields and if valid run onSave callback passing updated data to it
- **Validation:** Front: max 500 chars, Back: max 200 chars, both required.
- **Types:** `EditFlashcardData` (contains front and back fields).
- **Props:** Flashcard to edit, onSave callback.

### SubmitFlashcardsButton
- **Description:** Button to submit all accepted flashcards.
- **Main Elements:** A single button element.
- **Events:** OnClick calls onSubmit handler.
- **Validation:**: none
- **Types:**: none
- **Props:** onSubmit handler, isDisabled flag - to disable when api call is in progress or no accepted flashcards.

### ToastNotifications
- **Description:** Component to display transient messages.
- **Main Elements:** Notification container.
- **Events:** Auto-dismiss after a timeout.
- **Validation:** None.
- **Types:** Toast message model (text, type).
- **Props:** Message text, type (success/error).

## 5. Types

- **GeneratedFlashcardData:**
  - front: string (max 500)
  - back: string (max 200)
  - source: 'AIFull' | 'AIEdited' (for AI-generated flashcards)
  - generationId?: number (required for AI flashcards; same across all flashcards in a session)
  - isAccepted: boolean (flag for accepted cards)

- **FlashcardListItemData:**
  - front: string (max 500)
  - back: string (max 200)
  - isAccepted: boolean (flag for accepted cards)

- **EditFlashcardData:**  
  - front: string (required, max 500)
  - back: string (required, max 200)

- **CreateFlashcardsRequest:**: a type from `api.ts` that contains the request body for creating flashcards.

- **GenerateFlashcardsRequest:**: a type from `api.ts` that contains the request body for generating flashcards.

- **ResponseOfGenerateFlashcardsResponse:**: a type from `api.ts` that contains the response body for generating flashcards.

- **Response:**: a type from `api.ts` that contains the response body for creating flashcards.

## 6. State Management
- **Local State Variables:**
  - sourceText (string)
  - generatedFlashcards (GeneratedFlashcardData[])
  - modalState (object containing isOpen flag and flashcard to edit)
  - loading & error flags for API calls
- **Custom Hooks:**
  - useFlashcardGeneration for handling API calls and flashcard state management.
  - useModal for managing the edit modal open/close state.

## 7. API Integration
- **Generate Flashcards API (POST /flashcards/generate)**
  - Request Type: `GenerateFlashcardsRequest`
  - Response Type: `ResponseOfGenerateFlashcardsResponse`
- **Create Flashcards API (POST /flashcards)**
  - Request Type: `CreateFlashcardsRequest`
  - Response Type: `Response`
- Integration via the provided `api.ts` HTTP client with method calls respectively.

## 8. User Interactions
- User enters text into the textarea; The textarea is limited to 10,000 characters with inline validation.
- On clicking “Generate”, a loading state is triggered and the generate API is called; flashcards are populated on success.
- Users review generated cards:
  - Accepting sets a flag in the flashcard state (isAccepted = true).
  - Rejecting sets a flag in the flashcard state (isAccepted = false).
  - Editing opens the modal where the fields can be updated. Upon saving, changes update the corresponding card.
- Clicking “Submit flashcards” sends only accepted flashcards to the create API. Appropriate toasts are shown on success or failure.

## 9. Conditions and Validation
- TextArea: Maximum 10,000 characters. Required field.
- Edit Modal: Ensure “Front” not exceeding 500 characters, “Back” not exceeding 200 characters. Both fields are required.
- Inline error messaging for validation issues immediately.

## 10. Handling Errors
- Display toast notifications for server errors.
- Show inline error messages next to the text area or modal fields if validation fails.
- Handle network/API errors with a toast message and reset loading state (enable buttons again).

## 11. Implementation Steps
1. Create a new route `/generate` that renders the GenerateView component.
2. Build the GenerateView component with local state for text, flashcards, and modal visibility.
3. Implement TextArea ensuring character limit validation.
4. Integrate a button that calls the generate API using the provided API client; update flashcard list state upon success.
5. Render the FlashcardList component, mapping each flashcard to a FlashcardListItem component.
6. Add inline Accept, Reject, and Edit controls in each FlashcardListItem to update state.
7. Implement the EditFlashcardModal with form validation; on submission, update the corresponding flashcard state.
8. Add the SubmitFlashcardsButton that when clicked, will trigger posting accepted flashcards using the create API.
9. Integrate ToastNotifications for feedback success or error messages.
10. Write unit tests (using Vitest/React Testing Library) to validate interactions, state updates, and API integration.